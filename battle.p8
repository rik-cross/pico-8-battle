pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()

 world={}

 -- p1 entity
 add(world, {
  -- position component
  pos={x=10,y=10},
  -- intention component
  int={u=false,d=false,l=false,r=false,s=false},
  -- graphics component
  sprite=1,
  -- controls component
  controls={u=2,d=3,l=0,r=1},
  -- camera component
  cam={bg=3,x=0,y=0,w=8,h=12}
 })
 
 -- p2 entity
 add(world, {
  -- position component
  pos={x=10,y=50},
  -- intention component
  int={u=false,d=false,l=false,r=false,s=false},
  -- graphics component
  sprite=2,
  -- controls component
  controls={u=12,d=13,l=14,r=14},
  -- camera component
  cam={bg=4,x=60,y=0,w=8,h=12}
 })

end

function _update()

 -- control system
 for e in all(world) do
  if e["controls"] and e["pos"] then
   
   if (btn(e.controls.u)) e.int.u = true
   if (btn(e.controls.d)) e.int.d = true
   if (btn(e.controls.l)) e.int.l = true
   if (btn(e.controls.r)) e.int.r = true
   
  end
 end

 -- physics system
 for e in all(world) do
  if e["pos"] then
  
   local x_new = e.pos.x
   local y_new = e.pos.y
  
   -- if entity wants to move up
   if (e.int.u) then
    y_new = e.pos.y - 1
    e.int.u = false
   end
   
   -- if entity wants to move down
   if (e.int.d) then
    y_new = e.pos.y + 1
    e.int.d = false
   end
   
   -- if entity wants to move up
   if (e.int.l) then
    x_new = e.pos.x - 1
    e.int.l = false
   end
   
   -- if entity wants to move up
   if (e.int.r) then
    x_new = e.pos.x + 1
    e.int.r = false
   end
   
   -- do a hittest here
   
   -- update position
   e.pos.x = x_new
   e.pos.y = y_new
  
  end
 end

end

function _draw()

 cls()
 
 rectfill(0, 0, 127, 127, 1)
 
 -- graphics system
 for z in all(world) do
  if z["cam"] then
  
   rectfill(z.cam.x*8,z.cam.y*8,z.cam.w*8,z.cam.h*8,z.cam.bg)
  
   local map_x = z.cam.x + (z.cam.w*8)/2 - z.pos.x - 4
   local map_y = z.cam.y + (z.cam.h*8)/2 - z.pos.y - 4
  
   clip(z.cam.x,z.cam.y,z.cam.w*8,z.cam.h*8)
  
   map(0,0,map_x,map_y)
  
   for e in all(world) do
    if e["pos"] and e["sprite"] then
     -- if e["pos"]["x"] <  then 
      spr(e.sprite,e.pos.x + map_x,e.pos.y + map_y)
     -- end
    end
   end
 
   clip()
 
  end
 end
 
end
__gfx__
00000000001111000022220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011111100222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700111111112222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000111111192222222900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000111111192222222900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700111111112222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011111100222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001111000022220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7777f77755555555ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6666f76656666665ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6666f76656666665ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff56666665ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
f777777756666665ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
f766666656666665ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
f766666656666665ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff55555555ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1111111111111111111112121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010101010101112121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010101010101112121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010101010101112121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111101010101112121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010101010101112121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010101010101112121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010101010101112121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111112121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121212121212121212121212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
